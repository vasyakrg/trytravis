# Выполнено ДЗ № 10

 - [X] Основное ДЗ
 - [X] Задание со *
 - [] Задание со **

## В процессе сделано:
  - теперь окружения поднимаются одновременно и независимо друг от друга (это реализовано как в terraform, так и в ansible)
  - теперь ansible работает через роли и устанвливает их используя динамический инвентори (получаемый с вывода от terraform)
  - добавлена роль проксирующего nginx на stage окружении, что бы приложение было доступно по 80-му порту
  - в terraform так же реализовано открытие необходимых портов через переменную в нужном нам окружении

## Задание со звездочкой:
  - динамический инвентори уже был, разве что переписал тераформ так, что бы можно было держать активными сразу оба окружения и сразу на обоих проводить тесты
  - trytravis  - это шедевр! помучился с тестами, в итоге решил не изобретать корову, взял за основу готовый (ваш) докер, написал тесты синтаксиса, максимально учитывая независимость от конкртерного проекта и имен файлов и запустил после ваших тестов - свои
  - немного попучился с удаленными стейтами тераформы - их же надо было как то поиметь на докере, а креды от битбакета просто так не передашь.
    - решил так:

## Как запустить проект:
  1. скомпилировать образы
    > ./packer/deploy_db_ruby.sh

  2. поднять два инстанса под базу и приложение
    - перейти в папку terraform/stage или terraform/prod
    - переименовать файлы **terraform.tfvars.example** в **terraform.tfvars** и **variables.tf.example** в **variables.tf** и заполнить необходимыми значениями
    - перейти в папку terraform/stage или terraform/prod и запустить выполнение конфигурации
      > terraform init && terraform apply

  3. запустить ansible
    - для stage-окружения
      > cd ansible && ansible-playbook playbook/site.yml

    - для prod-окружения
      > cd ansible && ansible-playbook playbooks/site.yml -i environments/prod/inv-prod.sh

## Как проверить работоспособность:
 - открыть в браузере (необходимо ваше доменное имя):
  > http://app1-stage.aits.life/
  > http://app1-prod.aits.life:9292/


## PR checklist
 - [X] Выставил label ansible
 - [X] Выставил label ansible-3
